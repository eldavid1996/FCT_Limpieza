<section class="p-5 mt-10">
  <div
    class="font-bold text-3xl mb-2 w-4/5 mx-auto py-5 text-[#01161e] shadow-lg text-center bg-[#eff6e0] rounded"
  >
    <p class="drop-shadow-lg">Tareas activas</p>
  </div>
  <!-- TASKS TABLE-->
  <div
    class="sm:w-full lg:w-4/5 mx-auto rounded overflow-hidden shadow-lg beige"
  >
    <div *ngIf="showActiveTasks">
      <div class="px-6 py-4 flex justify-between">
        <div class="flex justify-center mb-1">
          <button
            class="boton-nuevo"
            mat-flat-button
            color="primary"
            (click)="toggleShowActiveTasks(false)"
          >
            {{
              showActiveTasks ? "Mostrar Histórico" : "Mostrar Tareas Activas"
            }}
          </button>
        </div>

        <mat-radio-group
          [value]="searchRadioButtonValue"
          (change)="onRadioButtonChange($event)"
        >
          <mat-radio-button value="Status">Estado</mat-radio-button>
          <mat-radio-button value="Priority">Prioridad</mat-radio-button>
          <mat-radio-button value="User.Name">Empleado</mat-radio-button>
          <mat-radio-button value="Room.RoomNumber"
            >Habitación</mat-radio-button
          >
          <mat-radio-button value="Observations"
            >Observaciones</mat-radio-button
          >
        </mat-radio-group>
        <input
          type="text"
          (keyup)="taskFilter($event)"
          placeholder="Buscar..."
        />
      </div>
      <div>
        <mat-table
          [dataSource]="dataSource"
          matSort
          (matSortChange)="orderColumns($event)"
          class="table w-full"
          style="border-collapse: collapse"
        >
          <!-- Status Column -->
          <ng-container matColumnDef="Status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
            <td
              mat-cell
              *matCellDef="let element"
              [class.green]="this.element.status !== 'Pendiente'"
              [class.orange]="this.element.status === 'Pendiente'"
            >
              {{ element.status }}
            </td>
          </ng-container>

          <!-- Priority Column -->
          <ng-container matColumnDef="Priority" class="hover:bg-gray-700">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Prioridad</th>
            <td
              mat-cell
              *matCellDef="let element"
              [class.green]="this.element.status !== 'Pendiente'"
              [class.orange]="this.element.status === 'Pendiente'"
            >
              <!-- priority cases -->
              <div [ngSwitch]="element.priority">
                <ng-container *ngSwitchCase="'0'">
                  <span>Baja</span>
                </ng-container>
                <ng-container *ngSwitchCase="'1'">
                  <span>Normal</span>
                </ng-container>
                <ng-container *ngSwitchCase="'2'">
                  <span>Alta</span>
                </ng-container>
                <ng-container *ngSwitchDefault>
                  <span>{{ element.priority }}</span>
                </ng-container>
              </div>
            </td>
          </ng-container>

          <!-- User Column -->
          <ng-container matColumnDef="User.Name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Empleado</th>
            <td
              mat-cell
              *matCellDef="let element"
              [class.green]="this.element.status !== 'Pendiente'"
              [class.orange]="this.element.status === 'Pendiente'"
            >
              {{ element.user.name }} {{ element.user.surname }}
            </td>
          </ng-container>

          <!-- Room Column -->
          <ng-container
            matColumnDef="Room.RoomNumber"
            class="max-md:invisible col-telf"
          >
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              Habitación
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              [class.green]="this.element.status !== 'Pendiente'"
              [class.orange]="this.element.status === 'Pendiente'"
            >
              Nº {{ element.room.roomNumber }}
              <span *ngIf="element.room.floor"
                >- Planta {{ element.room.floor }}</span
              >
            </td>
          </ng-container>

          <!-- Observations Column -->
          <ng-container matColumnDef="Observations">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              Observaciones
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              [class.green]="this.element.status !== 'Pendiente'"
              [class.orange]="this.element.status === 'Pendiente'"
            >
              {{ element.observations }}
            </td>
          </ng-container>

          <!-- Options Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td
              mat-cell
              *matCellDef="let element"
              [class.green]="this.element.status !== 'Pendiente'"
              [class.orange]="this.element.status === 'Pendiente'"
            >
              <button
                title="Editar"
                mat-icon-button
                color="primary"
                (click)="updateTask(element)"
              >
                <mat-icon>edit</mat-icon>
              </button>
              <button
                title="Eliminar"
                mat-icon-button
                color="warn"
                (click)="deleteTask(element.id, element)"
              >
                <mat-icon>delete</mat-icon>
              </button>
              <button
                title="Enviar al histórico"
                mat-icon-button
                (click)="moveTaskToHistory(element.id, element)"
              >
                <mat-icon class="text-purple-600">task</mat-icon>
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </mat-table>

        <!-- Paginacion -->
        <mat-paginator
          (page)="eventPager($event)"
          #paginacion
          [pageSize]="paginationRequest.pageSize"
          [pageSizeOptions]="comboPages"
          [length]="totalTasks"
        ></mat-paginator>
      </div>
    </div>
    <!-- TASK HISTORY TABLE COMPONENT -->
    <app-task-history-table
      *ngIf="!showActiveTasks"
      (showActiveTasksChange)="toggleShowActiveTasks(true)"
    ></app-task-history-table>
    <div *ngIf="!showActiveTasks" class="px-8 pt-4 pb-2 flex justify-between">
      <button
        class="boton-borrar px-4 py-2"
        mat-flat-button
        (click)="deleteHistory()"
      >
        Borrar histórico<mat-icon>delete</mat-icon>
      </button>

      <button
        class="boton-nuevo px-4 py-2"
        mat-flat-button
        (click)="insertTask()"
        [disabled]="!showActiveTasks"
      >
        Añadir tarea<mat-icon>task</mat-icon>
      </button>
    </div>
    <div class="flex justify-end px-8 pt-4 pb-2" *ngIf="showActiveTasks">
      <button
        class="boton-nuevo px-4 py-2 ml-auto"
        mat-flat-button
        (click)="insertTask()"
        [disabled]="!showActiveTasks"
      >
        Añadir tarea<mat-icon>task</mat-icon>
      </button>
    </div>
  </div>
  <div class="w-4/5 mx-auto bg-[#01161e] text-white mt-2 rounded px-10 py-3">
    <p>
      <strong>Info: </strong>La información puede ser filtrada por las distintas
      opciones para facilitar el uso de la aplicación.
    </p>
  </div>
</section>
